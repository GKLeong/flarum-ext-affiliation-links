{"version":3,"sources":["webpack://@kilowhat/affiliation-links/webpack/bootstrap","webpack://@kilowhat/affiliation-links/external \"flarum.core.compat['app']\"","webpack://@kilowhat/affiliation-links/external \"flarum.core.compat['Model']\"","webpack://@kilowhat/affiliation-links/external \"flarum.core.compat['Component']\"","webpack://@kilowhat/affiliation-links/external \"flarum.core.compat['components/Button']\"","webpack://@kilowhat/affiliation-links/external \"flarum.core.compat['components/Select']\"","webpack://@kilowhat/affiliation-links/external \"flarum.core.compat['utils/mixin']\"","webpack://@kilowhat/affiliation-links/external \"flarum.core.compat['components/SettingsModal']\"","webpack://@kilowhat/affiliation-links/external \"flarum.core.compat['helpers/icon']\"","webpack://@kilowhat/affiliation-links/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@kilowhat/affiliation-links/./src/admin/models/Rule.js","webpack://@kilowhat/affiliation-links/./node_modules/html5sortable/dist/html5sortable.es.js","webpack://@kilowhat/affiliation-links/./src/admin/components/RuleEdit.js","webpack://@kilowhat/affiliation-links/./src/admin/components/RuleList.js","webpack://@kilowhat/affiliation-links/./src/admin/helpers/sortByAttribute.js","webpack://@kilowhat/affiliation-links/./src/admin/components/AffiliationSettingsModal.js","webpack://@kilowhat/affiliation-links/./src/admin/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","_inheritsLoose","subClass","superClass","constructor","__proto__","Rule","apiEndpoint","this","exists","data","id","mixin","Model","sort","attribute","match_component","match_type","match_pattern","replacement","comment","addData","element","undefined","h5s","_filter","nodes","selector","NodeList","HTMLCollection","Array","Error","from","filter","item","nodeType","matches","stores","Map","Store","_config","_placeholder","_data","config","forEach","set","mergedConfig","assign","entries","configurable","setConfig","has","getConfig","placeholder","HTMLElement","setData","getData","deleteData","delete","store","sortableElement","addEventListener","eventName","callback","length","removeEventListener","addAttribute","setAttribute","removeAttribute","_offset","parentElement","getClientRects","rect","left","window","pageXOffset","right","top","pageYOffset","bottom","_debounce","func","wait","timeout","args","_i","arguments","clearTimeout","setTimeout","apply","_index","elementList","indexOf","isInDom","parentNode","insertNode","referenceNode","newElement","position","insertBefore","nextElementSibling","target","insertAfter","_serialize","sortableContainer","customItemSerializer","customContainerSerializer","serializedItem","serializedContainer","isSortable","items","children","serializedItems","map","parent","node","html","outerHTML","index","container","itemCount","_makePlaceholder","placeholderClass","_a","includes","tagName","document","createElement","innerHTML","classList","add","split","_getElementHeight","style","getComputedStyle","int","parseInt","getPropertyValue","isNaN","reduce","sum","_getElementWidth","_getHandles","querySelector","shadowRoot","getEventTarget","event","composedPath","defaultDragImage","draggedElement","elementOffset","posX","pageX","posY","pageY","setDragImage","customDragImage","Event","dataTransfer","dragImage","effectAllowed","_listsConnected","destination","origin","acceptFrom","sel","defaultConfiguration","connectWith","disableIEFix","copy","draggingClass","hoverClass","debounce","throttleTime","maxItems","itemSerializer","containerSerializer","orientation","dragging","draggingHeight","draggingWidth","originContainer","originIndex","originElementIndex","originItemsBeforeUpdate","previousContainer","destinationItemsBeforeUpdate","enableHoverClass","enable","hoverClasses_1","fn","threshold","_this","lastEventTimestamp","now","Date","_throttle","buttons","_b","remove","_removeItemEvents","_getDragging","draggedItem","sortable","ditem","cloneNode","appendChild","display","oldDisplay","_removeSortableData","_removeItemData","findSortable","find","el","findDragElement","options","itemlist","ele","contains","_enableSortable","opts","handles","handle","dragDrop","_reloadSortable","sortableElements","method","String","querySelectorAll","slice","test","configKey","console","warn","customPlaceholder","listItems","tempContainer","e","stopImmediatePropagation","getAttribute","dragItem","dispatchEvent","CustomEvent","detail","elementIndex","originalTarget","itemsBeforeUpdate","visiblePlaceholder","values","preventDefault","stopPropagation","originItems","destinationContainer","destinationItems","destinationElementIndex","destinationIndex","debouncedDragOverEnter","forcePlaceholderSize","height","width","thisHeight","thisWidth","placeholderIndex","thisIndex","deadZoneVertical","deadZoneHorizontal","offsetTop","offsetLeft","placeAfter","elementMiddleVertical","offsetHeight","elementMiddleHorizontal","offsetWidth","placeholders","onDragOverEnter","dropEffect","concat","destroy","_destroySortable","disable","_disableSortable","__testing","RuleEdit","init","rule","props","dirty","processing","toggleFields","initNewField","app","createRecord","attributes","boxTitle","translator","trans","view","onclick","icon","viewFields","Select","component","onchange","updateAttribute","uri","host","path","exact","simple","regex","type","oninput","withAttr","Button","className","loading","disabled","readyToSave","savePolicy","deletePolicy","pushAttributes","createNewRecord","save","then","redraw","err","confirm","join","Component","RuleList","request","url","forum","result","pushPayload","sorting","$","updateSort","attr","rules","all","fieldsList","a","b","push","AffiliationSettingsModal","title","form","SettingsModal","initializers","models","extensionSettings","modal","show"],"mappings":"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","file":"admin.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/Select'];","module.exports = flarum.core.compat['utils/mixin'];","module.exports = flarum.core.compat['components/SettingsModal'];","module.exports = flarum.core.compat['helpers/icon'];","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import Model from 'flarum/Model';\nimport mixin from 'flarum/utils/mixin';\n\nexport default class Rule extends mixin(Model, {\n    sort: Model.attribute('sort'),\n    match_component: Model.attribute('match_component'),\n    match_type: Model.attribute('match_type'),\n    match_pattern: Model.attribute('match_pattern'),\n    replacement: Model.attribute('replacement'),\n    comment: Model.attribute('comment'),\n}) {\n    /**\n     * @inheritDoc\n     */\n    apiEndpoint() {\n        return '/kilowhat-affiliation-links/rules' + (this.exists ? '/' + this.data.id : '');\n    }\n}\n","/*\n * HTML5Sortable package\n * https://github.com/lukasoppermann/html5sortable\n *\n * Maintained by Lukas Oppermann <lukas@vea.re>\n *\n * Released under the MIT license.\n */\n/**\n * Get or set data on element\n * @param {HTMLElement} element\n * @param {string} key\n * @param {any} value\n * @return {*}\n */\nfunction addData(element, key, value) {\n    if (value === undefined) {\n        return element && element.h5s && element.h5s.data && element.h5s.data[key];\n    }\n    else {\n        element.h5s = element.h5s || {};\n        element.h5s.data = element.h5s.data || {};\n        element.h5s.data[key] = value;\n    }\n}\n/**\n * Remove data from element\n * @param {HTMLElement} element\n */\nfunction removeData(element) {\n    if (element.h5s) {\n        delete element.h5s.data;\n    }\n}\n\n/* eslint-env browser */\n/**\n * Filter only wanted nodes\n * @param {NodeList|HTMLCollection|Array} nodes\n * @param {String} selector\n * @returns {Array}\n */\nvar _filter = (function (nodes, selector) {\n    if (!(nodes instanceof NodeList || nodes instanceof HTMLCollection || nodes instanceof Array)) {\n        throw new Error('You must provide a nodeList/HTMLCollection/Array of elements to be filtered.');\n    }\n    if (typeof selector !== 'string') {\n        return Array.from(nodes);\n    }\n    return Array.from(nodes).filter(function (item) { return item.nodeType === 1 && item.matches(selector); });\n});\n\n/* eslint-env browser */\nvar stores = new Map();\n/**\n * Stores data & configurations per Sortable\n * @param {Object} config\n */\nvar Store = /** @class */ (function () {\n    function Store() {\n        this._config = new Map(); // eslint-disable-line no-undef\n        this._placeholder = undefined; // eslint-disable-line no-undef\n        this._data = new Map(); // eslint-disable-line no-undef\n    }\n    Object.defineProperty(Store.prototype, \"config\", {\n        /**\n         * get the configuration map of a class instance\n         * @method config\n         * @return {object}\n         */\n        get: function () {\n            // transform Map to object\n            var config = {};\n            this._config.forEach(function (value, key) {\n                config[key] = value;\n            });\n            // return object\n            return config;\n        },\n        /**\n         * set the configuration of a class instance\n         * @method config\n         * @param {object} config object of configurations\n         */\n        set: function (config) {\n            if (typeof config !== 'object') {\n                throw new Error('You must provide a valid configuration object to the config setter.');\n            }\n            // combine config with default\n            var mergedConfig = Object.assign({}, config);\n            // add config to map\n            this._config = new Map(Object.entries(mergedConfig));\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * set individual configuration of a class instance\n     * @method setConfig\n     * @param  key valid configuration key\n     * @param  value any value\n     * @return void\n     */\n    Store.prototype.setConfig = function (key, value) {\n        if (!this._config.has(key)) {\n            throw new Error(\"Trying to set invalid configuration item: \" + key);\n        }\n        // set config\n        this._config.set(key, value);\n    };\n    /**\n     * get an individual configuration of a class instance\n     * @method getConfig\n     * @param  key valid configuration key\n     * @return any configuration value\n     */\n    Store.prototype.getConfig = function (key) {\n        if (!this._config.has(key)) {\n            throw new Error(\"Invalid configuration item requested: \" + key);\n        }\n        return this._config.get(key);\n    };\n    Object.defineProperty(Store.prototype, \"placeholder\", {\n        /**\n         * get the placeholder for a class instance\n         * @method placeholder\n         * @return {HTMLElement|null}\n         */\n        get: function () {\n            return this._placeholder;\n        },\n        /**\n         * set the placeholder for a class instance\n         * @method placeholder\n         * @param {HTMLElement} placeholder\n         * @return {void}\n         */\n        set: function (placeholder) {\n            if (!(placeholder instanceof HTMLElement) && placeholder !== null) {\n                throw new Error('A placeholder must be an html element or null.');\n            }\n            this._placeholder = placeholder;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /**\n     * set an data entry\n     * @method setData\n     * @param {string} key\n     * @param {any} value\n     * @return {void}\n     */\n    Store.prototype.setData = function (key, value) {\n        if (typeof key !== 'string') {\n            throw new Error('The key must be a string.');\n        }\n        this._data.set(key, value);\n    };\n    /**\n     * get an data entry\n     * @method getData\n     * @param {string} key an existing key\n     * @return {any}\n     */\n    Store.prototype.getData = function (key) {\n        if (typeof key !== 'string') {\n            throw new Error('The key must be a string.');\n        }\n        return this._data.get(key);\n    };\n    /**\n     * delete an data entry\n     * @method deleteData\n     * @param {string} key an existing key\n     * @return {boolean}\n     */\n    Store.prototype.deleteData = function (key) {\n        if (typeof key !== 'string') {\n            throw new Error('The key must be a string.');\n        }\n        return this._data.delete(key);\n    };\n    return Store;\n}());\n/**\n * @param {HTMLElement} sortableElement\n * @returns {Class: Store}\n */\nvar store = (function (sortableElement) {\n    // if sortableElement is wrong type\n    if (!(sortableElement instanceof HTMLElement)) {\n        throw new Error('Please provide a sortable to the store function.');\n    }\n    // create new instance if not avilable\n    if (!stores.has(sortableElement)) {\n        stores.set(sortableElement, new Store());\n    }\n    // return instance\n    return stores.get(sortableElement);\n});\n\n/**\n * @param {Array|HTMLElement} element\n * @param {Function} callback\n * @param {string} event\n */\nfunction addEventListener(element, eventName, callback) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            addEventListener(element[i], eventName, callback);\n        }\n        return;\n    }\n    element.addEventListener(eventName, callback);\n    store(element).setData(\"event\" + eventName, callback);\n}\n/**\n * @param {Array<HTMLElement>|HTMLElement} element\n * @param {string} eventName\n */\nfunction removeEventListener(element, eventName) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            removeEventListener(element[i], eventName);\n        }\n        return;\n    }\n    element.removeEventListener(eventName, store(element).getData(\"event\" + eventName));\n    store(element).deleteData(\"event\" + eventName);\n}\n\n/**\n * @param {Array<HTMLElement>|HTMLElement} element\n * @param {string} attribute\n * @param {string} value\n */\nfunction addAttribute(element, attribute, value) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            addAttribute(element[i], attribute, value);\n        }\n        return;\n    }\n    element.setAttribute(attribute, value);\n}\n/**\n * @param {Array|HTMLElement} element\n * @param {string} attribute\n */\nfunction removeAttribute(element, attribute) {\n    if (element instanceof Array) {\n        for (var i = 0; i < element.length; ++i) {\n            removeAttribute(element[i], attribute);\n        }\n        return;\n    }\n    element.removeAttribute(attribute);\n}\n\n/**\n * @param {HTMLElement} element\n * @returns {Object}\n */\nvar _offset = (function (element) {\n    if (!element.parentElement || element.getClientRects().length === 0) {\n        throw new Error('target element must be part of the dom');\n    }\n    var rect = element.getClientRects()[0];\n    return {\n        left: rect.left + window.pageXOffset,\n        right: rect.right + window.pageXOffset,\n        top: rect.top + window.pageYOffset,\n        bottom: rect.bottom + window.pageYOffset\n    };\n});\n\n/**\n * Creates and returns a new debounced version of the passed function which will postpone its execution until after wait milliseconds have elapsed\n * @param {Function} func to debounce\n * @param {number} time to wait before calling function with latest arguments, 0 - no debounce\n * @returns {function} - debounced function\n */\nvar _debounce = (function (func, wait) {\n    if (wait === void 0) { wait = 0; }\n    var timeout;\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        clearTimeout(timeout);\n        timeout = setTimeout(function () {\n            func.apply(void 0, args);\n        }, wait);\n    };\n});\n\n/* eslint-env browser */\n/**\n * Get position of the element relatively to its sibling elements\n * @param {HTMLElement} element\n * @returns {number}\n */\nvar _index = (function (element, elementList) {\n    if (!(element instanceof HTMLElement) || !(elementList instanceof NodeList || elementList instanceof HTMLCollection || elementList instanceof Array)) {\n        throw new Error('You must provide an element and a list of elements.');\n    }\n    return Array.from(elementList).indexOf(element);\n});\n\n/* eslint-env browser */\n/**\n * Test whether element is in DOM\n * @param {HTMLElement} element\n * @returns {boolean}\n */\nvar isInDom = (function (element) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('Element is not a node element.');\n    }\n    return element.parentNode !== null;\n});\n\n/* eslint-env browser */\n/**\n * Insert node before or after target\n * @param {HTMLElement} referenceNode - reference element\n * @param {HTMLElement} newElement - element to be inserted\n * @param {String} position - insert before or after reference element\n */\nvar insertNode = function (referenceNode, newElement, position) {\n    if (!(referenceNode instanceof HTMLElement) || !(referenceNode.parentElement instanceof HTMLElement)) {\n        throw new Error('target and element must be a node');\n    }\n    referenceNode.parentElement.insertBefore(newElement, (position === 'before' ? referenceNode : referenceNode.nextElementSibling));\n};\n/**\n * Insert before target\n * @param {HTMLElement} target\n * @param {HTMLElement} element\n */\nvar insertBefore = function (target, element) { return insertNode(target, element, 'before'); };\n/**\n * Insert after target\n * @param {HTMLElement} target\n * @param {HTMLElement} element\n */\nvar insertAfter = function (target, element) { return insertNode(target, element, 'after'); };\n\n/* eslint-env browser */\n/**\n * Filter only wanted nodes\n * @param {HTMLElement} sortableContainer\n * @param {Function} customSerializer\n * @returns {Array}\n */\nvar _serialize = (function (sortableContainer, customItemSerializer, customContainerSerializer) {\n    if (customItemSerializer === void 0) { customItemSerializer = function (serializedItem, sortableContainer) { return serializedItem; }; }\n    if (customContainerSerializer === void 0) { customContainerSerializer = function (serializedContainer) { return serializedContainer; }; }\n    // check for valid sortableContainer\n    if (!(sortableContainer instanceof HTMLElement) || !sortableContainer.isSortable === true) {\n        throw new Error('You need to provide a sortableContainer to be serialized.');\n    }\n    // check for valid serializers\n    if (typeof customItemSerializer !== 'function' || typeof customContainerSerializer !== 'function') {\n        throw new Error('You need to provide a valid serializer for items and the container.');\n    }\n    // get options\n    var options = addData(sortableContainer, 'opts');\n    var item = options.items;\n    // serialize container\n    var items = _filter(sortableContainer.children, item);\n    var serializedItems = items.map(function (item) {\n        return {\n            parent: sortableContainer,\n            node: item,\n            html: item.outerHTML,\n            index: _index(item, items)\n        };\n    });\n    // serialize container\n    var container = {\n        node: sortableContainer,\n        itemCount: serializedItems.length\n    };\n    return {\n        container: customContainerSerializer(container),\n        items: serializedItems.map(function (item) { return customItemSerializer(item, sortableContainer); })\n    };\n});\n\n/* eslint-env browser */\n/**\n * create a placeholder element\n * @param {HTMLElement} sortableElement a single sortable\n * @param {string|undefined} placeholder a string representing an html element\n * @param {string} placeholderClasses a string representing the classes that should be added to the placeholder\n */\nvar _makePlaceholder = (function (sortableElement, placeholder, placeholderClass) {\n    var _a;\n    if (placeholderClass === void 0) { placeholderClass = 'sortable-placeholder'; }\n    if (!(sortableElement instanceof HTMLElement)) {\n        throw new Error('You must provide a valid element as a sortable.');\n    }\n    // if placeholder is not an element\n    if (!(placeholder instanceof HTMLElement) && placeholder !== undefined) {\n        throw new Error('You must provide a valid element as a placeholder or set ot to undefined.');\n    }\n    // if no placeholder element is given\n    if (placeholder === undefined) {\n        if (['UL', 'OL'].includes(sortableElement.tagName)) {\n            placeholder = document.createElement('li');\n        }\n        else if (['TABLE', 'TBODY'].includes(sortableElement.tagName)) {\n            placeholder = document.createElement('tr');\n            // set colspan to always all rows, otherwise the item can only be dropped in first column\n            placeholder.innerHTML = '<td colspan=\"100\"></td>';\n        }\n        else {\n            placeholder = document.createElement('div');\n        }\n    }\n    // add classes to placeholder\n    if (typeof placeholderClass === 'string') {\n        (_a = placeholder.classList).add.apply(_a, placeholderClass.split(' '));\n    }\n    return placeholder;\n});\n\n/* eslint-env browser */\n/**\n * Get height of an element including padding\n * @param {HTMLElement} element an dom element\n */\nvar _getElementHeight = (function (element) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('You must provide a valid dom element');\n    }\n    // get calculated style of element\n    var style = window.getComputedStyle(element);\n    // pick applicable properties, convert to int and reduce by adding\n    return ['height', 'padding-top', 'padding-bottom']\n        .map(function (key) {\n        var int = parseInt(style.getPropertyValue(key), 10);\n        return isNaN(int) ? 0 : int;\n    })\n        .reduce(function (sum, value) { return sum + value; });\n});\n\n/* eslint-env browser */\n/**\n * Get width of an element including padding\n * @param {HTMLElement} element an dom element\n */\nvar _getElementWidth = (function (element) {\n    if (!(element instanceof HTMLElement)) {\n        throw new Error('You must provide a valid dom element');\n    }\n    // get calculated style of element\n    var style = window.getComputedStyle(element);\n    // pick applicable properties, convert to int and reduce by adding\n    return ['width', 'padding-left', 'padding-right']\n        .map(function (key) {\n        var int = parseInt(style.getPropertyValue(key), 10);\n        return isNaN(int) ? 0 : int;\n    })\n        .reduce(function (sum, value) { return sum + value; });\n});\n\n/* eslint-env browser */\n/**\n * get handle or return item\n * @param {Array<HTMLElement>} items\n * @param {string} selector\n */\nvar _getHandles = (function (items, selector) {\n    if (!(items instanceof Array)) {\n        throw new Error('You must provide a Array of HTMLElements to be filtered.');\n    }\n    if (typeof selector !== 'string') {\n        return items;\n    }\n    return items\n        // remove items without handle from array\n        .filter(function (item) {\n        return item.querySelector(selector) instanceof HTMLElement ||\n            (item.shadowRoot && item.shadowRoot.querySelector(selector) instanceof HTMLElement);\n    })\n        // replace item with handle in array\n        .map(function (item) {\n        return item.querySelector(selector) || (item.shadowRoot && item.shadowRoot.querySelector(selector));\n    });\n});\n\n/**\n * @param {Event} event\n * @returns {HTMLElement}\n */\nvar getEventTarget = (function (event) {\n    return (event.composedPath && event.composedPath()[0]) || event.target;\n});\n\n/* eslint-env browser */\n/**\n * defaultDragImage returns the current item as dragged image\n * @param {HTMLElement} draggedElement - the item that the user drags\n * @param {object} elementOffset - an object with the offsets top, left, right & bottom\n * @param {Event} event - the original drag event object\n * @return {object} with element, posX and posY properties\n */\nvar defaultDragImage = function (draggedElement, elementOffset, event) {\n    return {\n        element: draggedElement,\n        posX: event.pageX - elementOffset.left,\n        posY: event.pageY - elementOffset.top\n    };\n};\n/**\n * attaches an element as the drag image to an event\n * @param {Event} event - the original drag event object\n * @param {HTMLElement} draggedElement - the item that the user drags\n * @param {Function} customDragImage - function to create a custom dragImage\n * @return void\n */\nvar setDragImage = (function (event, draggedElement, customDragImage) {\n    // check if event is provided\n    if (!(event instanceof Event)) {\n        throw new Error('setDragImage requires a DragEvent as the first argument.');\n    }\n    // check if draggedElement is provided\n    if (!(draggedElement instanceof HTMLElement)) {\n        throw new Error('setDragImage requires the dragged element as the second argument.');\n    }\n    // set default function of none provided\n    if (!customDragImage) {\n        customDragImage = defaultDragImage;\n    }\n    // check if setDragImage method is available\n    if (event.dataTransfer && event.dataTransfer.setDragImage) {\n        // get the elements offset\n        var elementOffset = _offset(draggedElement);\n        // get the dragImage\n        var dragImage = customDragImage(draggedElement, elementOffset, event);\n        // check if custom function returns correct values\n        if (!(dragImage.element instanceof HTMLElement) || typeof dragImage.posX !== 'number' || typeof dragImage.posY !== 'number') {\n            throw new Error('The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].');\n        }\n        // needs to be set for HTML5 drag & drop to work\n        event.dataTransfer.effectAllowed = 'copyMove';\n        // Firefox requires it to use the event target's id for the data\n        event.dataTransfer.setData('text/plain', getEventTarget(event).id);\n        // set the drag image on the event\n        event.dataTransfer.setDragImage(dragImage.element, dragImage.posX, dragImage.posY);\n    }\n});\n\n/**\n * Check if curList accepts items from destList\n * @param {sortable} destination the container an item is move to\n * @param {sortable} origin the container an item comes from\n */\nvar _listsConnected = (function (destination, origin) {\n    // check if valid sortable\n    if (destination.isSortable === true) {\n        var acceptFrom = store(destination).getConfig('acceptFrom');\n        // check if acceptFrom is valid\n        if (acceptFrom !== null && acceptFrom !== false && typeof acceptFrom !== 'string') {\n            throw new Error('HTML5Sortable: Wrong argument, \"acceptFrom\" must be \"null\", \"false\", or a valid selector string.');\n        }\n        if (acceptFrom !== null) {\n            return acceptFrom !== false && acceptFrom.split(',').filter(function (sel) {\n                return sel.length > 0 && origin.matches(sel);\n            }).length > 0;\n        }\n        // drop in same list\n        if (destination === origin) {\n            return true;\n        }\n        // check if lists are connected with connectWith\n        if (store(destination).getConfig('connectWith') !== undefined && store(destination).getConfig('connectWith') !== null) {\n            return store(destination).getConfig('connectWith') === store(origin).getConfig('connectWith');\n        }\n    }\n    return false;\n});\n\n/**\n * default configurations\n */\nvar defaultConfiguration = {\n    items: null,\n    // deprecated\n    connectWith: null,\n    // deprecated\n    disableIEFix: null,\n    acceptFrom: null,\n    copy: false,\n    placeholder: null,\n    placeholderClass: 'sortable-placeholder',\n    draggingClass: 'sortable-dragging',\n    hoverClass: false,\n    debounce: 0,\n    throttleTime: 100,\n    maxItems: 0,\n    itemSerializer: undefined,\n    containerSerializer: undefined,\n    customDragImage: null,\n    orientation: 'vertical'\n};\n\n/**\n * make sure a function is only called once within the given amount of time\n * @param {Function} fn the function to throttle\n * @param {number} threshold time limit for throttling\n */\n// must use function to keep this context\nfunction _throttle (fn, threshold) {\n    var _this = this;\n    if (threshold === void 0) { threshold = 250; }\n    // check function\n    if (typeof fn !== 'function') {\n        throw new Error('You must provide a function as the first argument for throttle.');\n    }\n    // check threshold\n    if (typeof threshold !== 'number') {\n        throw new Error('You must provide a number as the second argument for throttle.');\n    }\n    var lastEventTimestamp = null;\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var now = Date.now();\n        if (lastEventTimestamp === null || now - lastEventTimestamp >= threshold) {\n            lastEventTimestamp = now;\n            fn.apply(_this, args);\n        }\n    };\n}\n\n/* eslint-env browser */\n/**\n * enable or disable hoverClass on mouseenter/leave if container Items\n * @param {sortable} sortableContainer a valid sortableContainer\n * @param {boolean} enable enable or disable event\n */\n// export default (sortableContainer: sortable, enable: boolean) => {\nvar enableHoverClass = (function (sortableContainer, enable) {\n    if (typeof store(sortableContainer).getConfig('hoverClass') === 'string') {\n        var hoverClasses_1 = store(sortableContainer).getConfig('hoverClass').split(' ');\n        // add class on hover\n        if (enable === true) {\n            addEventListener(sortableContainer, 'mousemove', _throttle(function (event) {\n                // check of no mouse button was pressed when mousemove started == no drag\n                if (event.buttons === 0) {\n                    _filter(sortableContainer.children, store(sortableContainer).getConfig('items')).forEach(function (item) {\n                        var _a, _b;\n                        if (item !== event.target) {\n                            (_a = item.classList).remove.apply(_a, hoverClasses_1);\n                        }\n                        else {\n                            (_b = item.classList).add.apply(_b, hoverClasses_1);\n                        }\n                    });\n                }\n            }, store(sortableContainer).getConfig('throttleTime')));\n            // remove class on leave\n            addEventListener(sortableContainer, 'mouseleave', function () {\n                _filter(sortableContainer.children, store(sortableContainer).getConfig('items')).forEach(function (item) {\n                    var _a;\n                    (_a = item.classList).remove.apply(_a, hoverClasses_1);\n                });\n            });\n            // remove events\n        }\n        else {\n            removeEventListener(sortableContainer, 'mousemove');\n            removeEventListener(sortableContainer, 'mouseleave');\n        }\n    }\n});\n\n/* eslint-env browser */\n/*\n * variables global to the plugin\n */\nvar dragging;\nvar draggingHeight;\nvar draggingWidth;\n/*\n * Keeps track of the initialy selected list, where 'dragstart' event was triggered\n * It allows us to move the data in between individual Sortable List instances\n */\n// Origin List - data from before any item was changed\nvar originContainer;\nvar originIndex;\nvar originElementIndex;\nvar originItemsBeforeUpdate;\n// Previous Sortable Container - we dispatch as sortenter event when a\n// dragged item enters a sortableContainer for the first time\nvar previousContainer;\n// Destination List - data from before any item was changed\nvar destinationItemsBeforeUpdate;\n/**\n * remove event handlers from items\n * @param {Array|NodeList} items\n */\nvar _removeItemEvents = function (items) {\n    removeEventListener(items, 'dragstart');\n    removeEventListener(items, 'dragend');\n    removeEventListener(items, 'dragover');\n    removeEventListener(items, 'dragenter');\n    removeEventListener(items, 'drop');\n    removeEventListener(items, 'mouseenter');\n    removeEventListener(items, 'mouseleave');\n};\n/**\n * _getDragging returns the current element to drag or\n * a copy of the element.\n * Is Copy Active for sortable\n * @param {HTMLElement} draggedItem - the item that the user drags\n * @param {HTMLElement} sortable a single sortable\n */\nvar _getDragging = function (draggedItem, sortable) {\n    var ditem = draggedItem;\n    if (store(sortable).getConfig('copy') === true) {\n        ditem = draggedItem.cloneNode(true);\n        addAttribute(ditem, 'aria-copied', 'true');\n        draggedItem.parentElement.appendChild(ditem);\n        ditem.style.display = 'none';\n        ditem.oldDisplay = draggedItem.style.display;\n    }\n    return ditem;\n};\n/**\n * Remove data from sortable\n * @param {HTMLElement} sortable a single sortable\n */\nvar _removeSortableData = function (sortable) {\n    removeData(sortable);\n    removeAttribute(sortable, 'aria-dropeffect');\n};\n/**\n * Remove data from items\n * @param {Array<HTMLElement>|HTMLElement} items\n */\nvar _removeItemData = function (items) {\n    removeAttribute(items, 'aria-grabbed');\n    removeAttribute(items, 'aria-copied');\n    removeAttribute(items, 'draggable');\n    removeAttribute(items, 'role');\n};\n/**\n * find sortable from element. travels up parent element until found or null.\n * @param {HTMLElement} element a single sortable\n * @param {Event} event - the current event. We need to pass it to be able to\n * find Sortable whith shadowRoot (document fragment has no parent)\n */\nfunction findSortable(element, event) {\n    if (event.composedPath) {\n        return event.composedPath().find(function (el) { return el.isSortable; });\n    }\n    while (element.isSortable !== true) {\n        element = element.parentElement;\n    }\n    return element;\n}\n/**\n * Dragging event is on the sortable element. finds the top child that\n * contains the element.\n * @param {HTMLElement} sortableElement a single sortable\n * @param {HTMLElement} element is that being dragged\n */\nfunction findDragElement(sortableElement, element) {\n    var options = addData(sortableElement, 'opts');\n    var items = _filter(sortableElement.children, options.items);\n    var itemlist = items.filter(function (ele) {\n        return ele.contains(element) || (ele.shadowRoot && ele.shadowRoot.contains(element));\n    });\n    return itemlist.length > 0 ? itemlist[0] : element;\n}\n/**\n * Destroy the sortable\n * @param {HTMLElement} sortableElement a single sortable\n */\nvar _destroySortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts') || {};\n    var items = _filter(sortableElement.children, opts.items);\n    var handles = _getHandles(items, opts.handle);\n    // remove event handlers & data from sortable\n    removeEventListener(sortableElement, 'dragover');\n    removeEventListener(sortableElement, 'dragenter');\n    removeEventListener(sortableElement, 'dragstart');\n    removeEventListener(sortableElement, 'dragend');\n    removeEventListener(sortableElement, 'drop');\n    // remove event data from sortable\n    _removeSortableData(sortableElement);\n    // remove event handlers & data from items\n    removeEventListener(handles, 'mousedown');\n    _removeItemEvents(items);\n    _removeItemData(items);\n    // clear sortable flag\n    sortableElement.isSortable = false;\n};\n/**\n * Enable the sortable\n * @param {HTMLElement} sortableElement a single sortable\n */\nvar _enableSortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts');\n    var items = _filter(sortableElement.children, opts.items);\n    var handles = _getHandles(items, opts.handle);\n    addAttribute(sortableElement, 'aria-dropeffect', 'move');\n    addData(sortableElement, '_disabled', 'false');\n    addAttribute(handles, 'draggable', 'true');\n    // @todo: remove this fix\n    // IE FIX for ghost\n    // can be disabled as it has the side effect that other events\n    // (e.g. click) will be ignored\n    if (opts.disableIEFix === false) {\n        var spanEl = (document || window.document).createElement('span');\n        if (typeof spanEl.dragDrop === 'function') {\n            addEventListener(handles, 'mousedown', function () {\n                if (items.indexOf(this) !== -1) {\n                    this.dragDrop();\n                }\n                else {\n                    var parent = this.parentElement;\n                    while (items.indexOf(parent) === -1) {\n                        parent = parent.parentElement;\n                    }\n                    parent.dragDrop();\n                }\n            });\n        }\n    }\n};\n/**\n * Disable the sortable\n * @param {HTMLElement} sortableElement a single sortable\n */\nvar _disableSortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts');\n    var items = _filter(sortableElement.children, opts.items);\n    var handles = _getHandles(items, opts.handle);\n    addAttribute(sortableElement, 'aria-dropeffect', 'none');\n    addData(sortableElement, '_disabled', 'true');\n    addAttribute(handles, 'draggable', 'false');\n    removeEventListener(handles, 'mousedown');\n};\n/**\n * Reload the sortable\n * @param {HTMLElement} sortableElement a single sortable\n * @description events need to be removed to not be double bound\n */\nvar _reloadSortable = function (sortableElement) {\n    var opts = addData(sortableElement, 'opts');\n    var items = _filter(sortableElement.children, opts.items);\n    var handles = _getHandles(items, opts.handle);\n    addData(sortableElement, '_disabled', 'false');\n    // remove event handlers from items\n    _removeItemEvents(items);\n    removeEventListener(handles, 'mousedown');\n    // remove event handlers from sortable\n    removeEventListener(sortableElement, 'dragover');\n    removeEventListener(sortableElement, 'dragenter');\n    removeEventListener(sortableElement, 'drop');\n};\n/**\n * Public sortable object\n * @param {Array|NodeList} sortableElements\n * @param {object|string} options|method\n */\nfunction sortable(sortableElements, options) {\n    // get method string to see if a method is called\n    var method = String(options);\n    options = options || {};\n    // check if the user provided a selector instead of an element\n    if (typeof sortableElements === 'string') {\n        sortableElements = document.querySelectorAll(sortableElements);\n    }\n    // if the user provided an element, return it in an array to keep the return value consistant\n    if (sortableElements instanceof HTMLElement) {\n        sortableElements = [sortableElements];\n    }\n    sortableElements = Array.prototype.slice.call(sortableElements);\n    if (/serialize/.test(method)) {\n        return sortableElements.map(function (sortableContainer) {\n            var opts = addData(sortableContainer, 'opts');\n            return _serialize(sortableContainer, opts.itemSerializer, opts.containerSerializer);\n        });\n    }\n    sortableElements.forEach(function (sortableElement) {\n        if (/enable|disable|destroy/.test(method)) {\n            return sortable[method](sortableElement);\n        }\n        // log deprecation\n        ['connectWith', 'disableIEFix'].forEach(function (configKey) {\n            if (Object.prototype.hasOwnProperty.call(options, configKey) && options[configKey] !== null) {\n                console.warn(\"HTML5Sortable: You are using the deprecated configuration \\\"\" + configKey + \"\\\". This will be removed in an upcoming version, make sure to migrate to the new options when updating.\");\n            }\n        });\n        // merge options with default options\n        options = Object.assign({}, defaultConfiguration, store(sortableElement).config, options);\n        // init data store for sortable\n        store(sortableElement).config = options;\n        // set options on sortable\n        addData(sortableElement, 'opts', options);\n        // property to define as sortable\n        sortableElement.isSortable = true;\n        // reset sortable\n        _reloadSortable(sortableElement);\n        // initialize\n        var listItems = _filter(sortableElement.children, options.items);\n        // create element if user defined a placeholder element as a string\n        var customPlaceholder;\n        if (options.placeholder !== null && options.placeholder !== undefined) {\n            var tempContainer = document.createElement(sortableElement.tagName);\n            if (options.placeholder instanceof HTMLElement) {\n                tempContainer.appendChild(options.placeholder);\n            }\n            else {\n                tempContainer.innerHTML = options.placeholder;\n            }\n            customPlaceholder = tempContainer.children[0];\n        }\n        // add placeholder\n        store(sortableElement).placeholder = _makePlaceholder(sortableElement, customPlaceholder, options.placeholderClass);\n        addData(sortableElement, 'items', options.items);\n        if (options.acceptFrom) {\n            addData(sortableElement, 'acceptFrom', options.acceptFrom);\n        }\n        else if (options.connectWith) {\n            addData(sortableElement, 'connectWith', options.connectWith);\n        }\n        _enableSortable(sortableElement);\n        addAttribute(listItems, 'role', 'option');\n        addAttribute(listItems, 'aria-grabbed', 'false');\n        // enable hover class\n        enableHoverClass(sortableElement, true);\n        /*\n         Handle drag events on draggable items\n         Handle is set at the sortableElement level as it will bubble up\n         from the item\n         */\n        addEventListener(sortableElement, 'dragstart', function (e) {\n            // ignore dragstart events\n            var target = getEventTarget(e);\n            if (target.isSortable === true) {\n                return;\n            }\n            e.stopImmediatePropagation();\n            if ((options.handle && !target.matches(options.handle)) || target.getAttribute('draggable') === 'false') {\n                return;\n            }\n            var sortableContainer = findSortable(target, e);\n            var dragItem = findDragElement(sortableContainer, target);\n            // grab values\n            originItemsBeforeUpdate = _filter(sortableContainer.children, options.items);\n            originIndex = originItemsBeforeUpdate.indexOf(dragItem);\n            originElementIndex = _index(dragItem, sortableContainer.children);\n            originContainer = sortableContainer;\n            // add transparent clone or other ghost to cursor\n            setDragImage(e, dragItem, options.customDragImage);\n            // cache selsection & add attr for dragging\n            draggingHeight = _getElementHeight(dragItem);\n            draggingWidth = _getElementWidth(dragItem);\n            dragItem.classList.add(options.draggingClass);\n            dragging = _getDragging(dragItem, sortableContainer);\n            addAttribute(dragging, 'aria-grabbed', 'true');\n            // dispatch sortstart event on each element in group\n            sortableContainer.dispatchEvent(new CustomEvent('sortstart', {\n                detail: {\n                    origin: {\n                        elementIndex: originElementIndex,\n                        index: originIndex,\n                        container: originContainer\n                    },\n                    item: dragging,\n                    originalTarget: target\n                }\n            }));\n        });\n        /*\n         We are capturing targetSortable before modifications with 'dragenter' event\n        */\n        addEventListener(sortableElement, 'dragenter', function (e) {\n            var target = getEventTarget(e);\n            var sortableContainer = findSortable(target, e);\n            if (sortableContainer && sortableContainer !== previousContainer) {\n                destinationItemsBeforeUpdate = _filter(sortableContainer.children, addData(sortableContainer, 'items'))\n                    .filter(function (item) { return item !== store(sortableElement).placeholder; });\n                sortableContainer.dispatchEvent(new CustomEvent('sortenter', {\n                    detail: {\n                        origin: {\n                            elementIndex: originElementIndex,\n                            index: originIndex,\n                            container: originContainer\n                        },\n                        destination: {\n                            container: sortableContainer,\n                            itemsBeforeUpdate: destinationItemsBeforeUpdate\n                        },\n                        item: dragging,\n                        originalTarget: target\n                    }\n                }));\n            }\n            previousContainer = sortableContainer;\n        });\n        /*\n         * Dragend Event - https://developer.mozilla.org/en-US/docs/Web/Events/dragend\n         * Fires each time dragEvent end, or ESC pressed\n         * We are using it to clean up any draggable elements and placeholders\n         */\n        addEventListener(sortableElement, 'dragend', function (e) {\n            if (!dragging) {\n                return;\n            }\n            dragging.classList.remove(options.draggingClass);\n            addAttribute(dragging, 'aria-grabbed', 'false');\n            if (dragging.getAttribute('aria-copied') === 'true' && addData(dragging, 'dropped') !== 'true') {\n                dragging.remove();\n            }\n            dragging.style.display = dragging.oldDisplay;\n            delete dragging.oldDisplay;\n            var visiblePlaceholder = Array.from(stores.values()).map(function (data) { return data.placeholder; })\n                .filter(function (placeholder) { return placeholder instanceof HTMLElement; })\n                .filter(isInDom)[0];\n            if (visiblePlaceholder) {\n                visiblePlaceholder.remove();\n            }\n            // dispatch sortstart event on each element in group\n            sortableElement.dispatchEvent(new CustomEvent('sortstop', {\n                detail: {\n                    origin: {\n                        elementIndex: originElementIndex,\n                        index: originIndex,\n                        container: originContainer\n                    },\n                    item: dragging\n                }\n            }));\n            previousContainer = null;\n            dragging = null;\n            draggingHeight = null;\n            draggingWidth = null;\n        });\n        /*\n         * Drop Event - https://developer.mozilla.org/en-US/docs/Web/Events/drop\n         * Fires when valid drop target area is hit\n         */\n        addEventListener(sortableElement, 'drop', function (e) {\n            if (!_listsConnected(sortableElement, dragging.parentElement)) {\n                return;\n            }\n            e.preventDefault();\n            e.stopPropagation();\n            addData(dragging, 'dropped', 'true');\n            // get the one placeholder that is currently visible\n            var visiblePlaceholder = Array.from(stores.values()).map(function (data) {\n                return data.placeholder;\n            })\n                // filter only HTMLElements\n                .filter(function (placeholder) { return placeholder instanceof HTMLElement; })\n                // filter only elements in DOM\n                .filter(isInDom)[0];\n            // attach element after placeholder\n            insertAfter(visiblePlaceholder, dragging);\n            // remove placeholder from dom\n            visiblePlaceholder.remove();\n            /*\n             * Fires Custom Event - 'sortstop'\n             */\n            sortableElement.dispatchEvent(new CustomEvent('sortstop', {\n                detail: {\n                    origin: {\n                        elementIndex: originElementIndex,\n                        index: originIndex,\n                        container: originContainer\n                    },\n                    item: dragging\n                }\n            }));\n            var placeholder = store(sortableElement).placeholder;\n            var originItems = _filter(originContainer.children, options.items)\n                .filter(function (item) { return item !== placeholder; });\n            var destinationContainer = this.isSortable === true ? this : this.parentElement;\n            var destinationItems = _filter(destinationContainer.children, addData(destinationContainer, 'items'))\n                .filter(function (item) { return item !== placeholder; });\n            var destinationElementIndex = _index(dragging, Array.from(dragging.parentElement.children)\n                .filter(function (item) { return item !== placeholder; }));\n            var destinationIndex = _index(dragging, destinationItems);\n            /*\n             * When a list item changed container lists or index within a list\n             * Fires Custom Event - 'sortupdate'\n             */\n            if (originElementIndex !== destinationElementIndex || originContainer !== destinationContainer) {\n                sortableElement.dispatchEvent(new CustomEvent('sortupdate', {\n                    detail: {\n                        origin: {\n                            elementIndex: originElementIndex,\n                            index: originIndex,\n                            container: originContainer,\n                            itemsBeforeUpdate: originItemsBeforeUpdate,\n                            items: originItems\n                        },\n                        destination: {\n                            index: destinationIndex,\n                            elementIndex: destinationElementIndex,\n                            container: destinationContainer,\n                            itemsBeforeUpdate: destinationItemsBeforeUpdate,\n                            items: destinationItems\n                        },\n                        item: dragging\n                    }\n                }));\n            }\n        });\n        var debouncedDragOverEnter = _debounce(function (sortableElement, element, pageX, pageY) {\n            if (!dragging) {\n                return;\n            }\n            // set placeholder height if forcePlaceholderSize option is set\n            if (options.forcePlaceholderSize) {\n                store(sortableElement).placeholder.style.height = draggingHeight + 'px';\n                store(sortableElement).placeholder.style.width = draggingWidth + 'px';\n            }\n            // if element the draggedItem is dragged onto is within the array of all elements in list\n            // (not only items, but also disabled, etc.)\n            if (Array.from(sortableElement.children).indexOf(element) > -1) {\n                var thisHeight = _getElementHeight(element);\n                var thisWidth = _getElementWidth(element);\n                var placeholderIndex = _index(store(sortableElement).placeholder, element.parentElement.children);\n                var thisIndex = _index(element, element.parentElement.children);\n                // Check if `element` is bigger than the draggable. If it is, we have to define a dead zone to prevent flickering\n                if (thisHeight > draggingHeight || thisWidth > draggingWidth) {\n                    // Dead zone?\n                    var deadZoneVertical = thisHeight - draggingHeight;\n                    var deadZoneHorizontal = thisWidth - draggingWidth;\n                    var offsetTop = _offset(element).top;\n                    var offsetLeft = _offset(element).left;\n                    if (placeholderIndex < thisIndex &&\n                        ((options.orientation === 'vertical' && pageY < offsetTop) ||\n                            (options.orientation === 'horizontal' && pageX < offsetLeft))) {\n                        return;\n                    }\n                    if (placeholderIndex > thisIndex &&\n                        ((options.orientation === 'vertical' && pageY > offsetTop + thisHeight - deadZoneVertical) ||\n                            (options.orientation === 'horizontal' && pageX > offsetLeft + thisWidth - deadZoneHorizontal))) {\n                        return;\n                    }\n                }\n                if (dragging.oldDisplay === undefined) {\n                    dragging.oldDisplay = dragging.style.display;\n                }\n                if (dragging.style.display !== 'none') {\n                    dragging.style.display = 'none';\n                }\n                // To avoid flicker, determine where to position the placeholder\n                // based on where the mouse pointer is relative to the elements\n                // vertical center.\n                var placeAfter = false;\n                try {\n                    var elementMiddleVertical = _offset(element).top + element.offsetHeight / 2;\n                    var elementMiddleHorizontal = _offset(element).left + element.offsetWidth / 2;\n                    placeAfter = (options.orientation === 'vertical' && (pageY >= elementMiddleVertical)) ||\n                        (options.orientation === 'horizontal' && (pageX >= elementMiddleHorizontal));\n                }\n                catch (e) {\n                    placeAfter = placeholderIndex < thisIndex;\n                }\n                if (placeAfter) {\n                    insertAfter(element, store(sortableElement).placeholder);\n                }\n                else {\n                    insertBefore(element, store(sortableElement).placeholder);\n                }\n                // get placeholders from all stores & remove all but current one\n                Array.from(stores.values())\n                    // remove empty values\n                    .filter(function (data) { return data.placeholder !== undefined; })\n                    // foreach placeholder in array if outside of current sorableContainer -> remove from DOM\n                    .forEach(function (data) {\n                    if (data.placeholder !== store(sortableElement).placeholder) {\n                        data.placeholder.remove();\n                    }\n                });\n            }\n            else {\n                // get all placeholders from store\n                var placeholders = Array.from(stores.values())\n                    .filter(function (data) { return data.placeholder !== undefined; })\n                    .map(function (data) {\n                    return data.placeholder;\n                });\n                // check if element is not in placeholders\n                if (placeholders.indexOf(element) === -1 && sortableElement === element && !_filter(element.children, options.items).length) {\n                    placeholders.forEach(function (element) { return element.remove(); });\n                    element.appendChild(store(sortableElement).placeholder);\n                }\n            }\n        }, options.debounce);\n        // Handle dragover and dragenter events on draggable items\n        var onDragOverEnter = function (e) {\n            var element = e.target;\n            var sortableElement = element.isSortable === true ? element : findSortable(element, e);\n            element = findDragElement(sortableElement, element);\n            if (!dragging || !_listsConnected(sortableElement, dragging.parentElement) || addData(sortableElement, '_disabled') === 'true') {\n                return;\n            }\n            var options = addData(sortableElement, 'opts');\n            if (parseInt(options.maxItems) && _filter(sortableElement.children, addData(sortableElement, 'items')).length >= parseInt(options.maxItems) && dragging.parentElement !== sortableElement) {\n                return;\n            }\n            e.preventDefault();\n            e.stopPropagation();\n            e.dataTransfer.dropEffect = store(sortableElement).getConfig('copy') === true ? 'copy' : 'move';\n            debouncedDragOverEnter(sortableElement, element, e.pageX, e.pageY);\n        };\n        addEventListener(listItems.concat(sortableElement), 'dragover', onDragOverEnter);\n        addEventListener(listItems.concat(sortableElement), 'dragenter', onDragOverEnter);\n    });\n    return sortableElements;\n}\nsortable.destroy = function (sortableElement) {\n    _destroySortable(sortableElement);\n};\nsortable.enable = function (sortableElement) {\n    _enableSortable(sortableElement);\n};\nsortable.disable = function (sortableElement) {\n    _disableSortable(sortableElement);\n};\n/* START.TESTS_ONLY */\nsortable.__testing = {\n    // add internal methods here for testing purposes\n    _data: addData,\n    _removeItemEvents: _removeItemEvents,\n    _removeItemData: _removeItemData,\n    _removeSortableData: _removeSortableData\n};\n\nexport default sortable;\n","import app from 'flarum/app';\nimport Component from 'flarum/Component';\nimport Button from 'flarum/components/Button';\nimport Select from 'flarum/components/Select';\nimport icon from 'flarum/helpers/icon';\n\n/* global m */\n\nexport default class RuleEdit extends Component {\n    init() {\n        this.rule = this.props.rule;\n        this.dirty = false;\n        this.processing = false;\n        this.toggleFields = false;\n\n        if (this.rule === null) {\n            this.initNewField();\n        }\n    }\n\n    initNewField() {\n        this.rule = app.store.createRecord('kilowhat-affiliation-links-rules', {\n            attributes: {\n                match_component: 'host',\n                match_type: 'exact',\n                match_pattern: '',\n                replacement: '',\n                comment: '',\n            },\n        });\n    }\n\n    boxTitle() {\n        if (this.rule.exists) {\n            return [\n                this.rule.match_pattern(),\n                ' ',\n                this.rule.comment() ? m('em', '(' + this.rule.comment().split('\\n')[0] + ')') : null,\n            ];\n        }\n\n        return app.translator.trans('kilowhat-affiliation-links.admin.buttons.new-rule');\n    }\n\n    view() {\n        return m('.Kilowhat-AffiliationLinks-Rule-Box', [\n            m('.Kilowhat-AffiliationLinks-Rule-Top', [\n                (this.rule.exists ? m('span.fas.fa-arrows-alt.Kilowhat-AffiliationLinks-Rule-Box--handle.js-rule-handle') : null),\n                m('.Button.Button--block.Kilowhat-AffiliationLinks-Rule-Header', {\n                    onclick: () => {\n                        this.toggleFields = !this.toggleFields;\n                    },\n                }, [\n                    m('.Kilowhat-AffiliationLinks-Rule-Header-Title', this.boxTitle()),\n                    m('div', [\n                        (this.rule.exists ? [\n                            app.translator.trans('kilowhat-affiliation-links.admin.buttons.edit-rule'),\n                            ' ',\n                        ] : null),\n                        icon(this.toggleFields ? 'fas fa-chevron-up' : 'fas fa-chevron-down'),\n                    ]),\n                ]),\n            ]),\n            (this.toggleFields ? this.viewFields() : null),\n        ]);\n    }\n\n    viewFields() {\n        return m('form.Kilowhat-AffiliationLinks-Rule-Body', [\n            m('.Form-group', [\n                m('label', app.translator.trans('kilowhat-affiliation-links.admin.rules.match-component')),\n                Select.component({\n                    value: this.rule.match_component(),\n                    onchange: this.updateAttribute.bind(this, 'match_component'),\n                    options: {\n                        uri: app.translator.trans('kilowhat-affiliation-links.admin.component-options.uri'),\n                        host: app.translator.trans('kilowhat-affiliation-links.admin.component-options.host'),\n                        path: app.translator.trans('kilowhat-affiliation-links.admin.component-options.path'),\n                    },\n                }),\n                m('.helpText', app.translator.trans('kilowhat-affiliation-links.admin.rules.match-component-help')),\n            ]),\n            m('.Form-group', [\n                m('label', app.translator.trans('kilowhat-affiliation-links.admin.rules.match-type')),\n                Select.component({\n                    value: this.rule.match_type(),\n                    onchange: this.updateAttribute.bind(this, 'match_type'),\n                    options: {\n                        exact: app.translator.trans('kilowhat-affiliation-links.admin.type-options.exact'),\n                        simple: app.translator.trans('kilowhat-affiliation-links.admin.type-options.simple'),\n                        regex: app.translator.trans('kilowhat-affiliation-links.admin.type-options.regex'),\n                    },\n                }),\n                m('.helpText', app.translator.trans('kilowhat-affiliation-links.admin.rules.match-type-help')),\n            ]),\n            m('.Form-group', [\n                m('label', app.translator.trans('kilowhat-affiliation-links.admin.rules.match-pattern')),\n                m('input.FormControl', {\n                    type: 'text',\n                    value: this.rule.match_pattern(),\n                    oninput: m.withAttr('value', this.updateAttribute.bind(this, 'match_pattern')),\n                }),\n                m('.helpText', app.translator.trans('kilowhat-affiliation-links.admin.rules.match-pattern-help')),\n            ]),\n            m('.Form-group', [\n                m('label', app.translator.trans('kilowhat-affiliation-links.admin.rules.replacement')),\n                m('input.FormControl', {\n                    type: 'text',\n                    value: this.rule.replacement(),\n                    oninput: m.withAttr('value', this.updateAttribute.bind(this, 'replacement')),\n                }),\n                m('.helpText', app.translator.trans('kilowhat-affiliation-links.admin.rules.replacement-help')),\n            ]),\n            m('.Form-group', [\n                m('label', app.translator.trans('kilowhat-affiliation-links.admin.rules.comment')),\n                m('textarea.FormControl', {\n                    value: this.rule.comment(),\n                    oninput: m.withAttr('value', this.updateAttribute.bind(this, 'comment')),\n                }),\n            ]),\n            m('.ButtonGroup', [\n                Button.component({\n                    type: 'submit',\n                    className: 'Button Button--primary',\n                    children: app.translator.trans('kilowhat-affiliation-links.admin.buttons.' + (this.rule.exists ? 'save' : 'add') + '-rule'),\n                    loading: this.processing,\n                    disabled: !this.readyToSave(),\n                    onclick: this.savePolicy.bind(this),\n                }),\n                (this.rule.exists ? Button.component({\n                    type: 'submit',\n                    className: 'Button Button--danger',\n                    children: app.translator.trans('kilowhat-affiliation-links.admin.buttons.delete-rule'),\n                    loading: this.processing,\n                    onclick: this.deletePolicy.bind(this),\n                }) : ''),\n            ]),\n        ]);\n    }\n\n    updateAttribute(attribute, value) {\n        this.rule.pushAttributes({\n            [attribute]: value,\n        });\n\n        this.dirty = true;\n    }\n\n    readyToSave() {\n        return this.dirty;\n    }\n\n    savePolicy() {\n        this.processing = true;\n\n        const createNewRecord = !this.rule.exists;\n\n        this.rule.save(this.rule.data.attributes).then(() => {\n            if (createNewRecord) {\n                this.initNewField();\n                this.toggleFields = false;\n            }\n\n            this.processing = false;\n            this.dirty = false;\n\n            m.redraw();\n        }).catch(err => {\n            this.processing = false;\n\n            throw err;\n        });\n    }\n\n    deletePolicy() {\n        if (!confirm(app.translator.trans('kilowhat-affiliation-links.admin.messages.delete-rule-confirmation', {\n                match_pattern: this.rule.match_pattern(),\n            }).join(''))) {\n            return;\n        }\n\n        this.processing = true;\n\n        this.rule.delete().then(() => {\n            this.processing = false;\n\n            m.redraw();\n        }).catch(err => {\n            this.processing = false;\n\n            throw err;\n        });\n    }\n}\n","import sortable from 'html5sortable/dist/html5sortable.es.js';\nimport app from 'flarum/app';\nimport Component from 'flarum/Component';\nimport sortByAttribute from '../helpers/sortByAttribute';\nimport RuleEdit from './RuleEdit';\n\n/* global m, $ */\n\nexport default class RuleList extends Component {\n    init() {\n        app.request({\n            method: 'GET',\n            url: app.forum.attribute('apiUrl') + '/kilowhat-affiliation-links/rules',\n        }).then(result => {\n            app.store.pushPayload(result);\n\n            m.redraw();\n        });\n    }\n\n    config() {\n        sortable(this.element.querySelector('.js-rules-container'), {\n            handle: '.js-rule-handle',\n        })[0].addEventListener('sortupdate', () => {\n            const sorting = this.$('.js-rule-data')\n                .map(function () {\n                    return $(this).data('id');\n                })\n                .get();\n\n            this.updateSort(sorting);\n        });\n    }\n\n    view() {\n        const rules = app.store.all('kilowhat-affiliation-links-rules');\n\n        let fieldsList = [];\n\n        sortByAttribute(rules)\n            .forEach(rule => {\n                // Build array of fields to show.\n                fieldsList.push(m('.js-rule-data', {\n                    key: rule.id(),\n                    'data-id': rule.id(),\n                }, RuleEdit.component({\n                    rule,\n                })));\n            });\n\n        return m('div', [\n            m('h2', app.translator.trans('kilowhat-affiliation-links.admin.titles.rules')),\n            m('.Kilowhat-AffiliationLinks-Rules-Container', [\n                m('.js-rules-container', fieldsList),\n                RuleEdit.component({\n                    key: 'new',\n                    rule: null,\n                }),\n            ]),\n        ]);\n    }\n\n    updateSort(sorting) {\n        app.request({\n            method: 'POST',\n            url: app.forum.attribute('apiUrl') + '/kilowhat-affiliation-links/rules/order',\n            data: {\n                sort: sorting,\n            },\n        }).then(result => {\n            // Update sort attributes\n            app.store.pushPayload(result);\n\n            m.redraw();\n        });\n    }\n}\n","export default function (items, attr = 'sort') {\n    return items.sort(\n        (a, b) => a[attr]() - b[attr]()\n    );\n}\n","import app from 'flarum/app';\nimport SettingsModal from 'flarum/components/SettingsModal';\nimport RuleList from './RuleList';\n\nexport default class AffiliationSettingsModal extends SettingsModal {\n    title() {\n        return app.translator.trans('kilowhat-affiliation-links.admin.settings.title');\n    }\n\n    form() {\n        return [\n            RuleList.component(),\n        ];\n    }\n}\n","import app from 'flarum/app';\nimport Rule from './models/Rule';\nimport AffiliationSettingsModal from './components/AffiliationSettingsModal';\n\napp.initializers.add('kilowhat-affiliation-links', app => {\n    app.store.models['kilowhat-affiliation-links-rules'] = Rule;\n\n    app.extensionSettings['kilowhat-affiliation-links'] = () => app.modal.show(new AffiliationSettingsModal());\n});\n"],"sourceRoot":""}